!function(a){"use strict";var b=a.module("webApp",["ui.router","ui.bootstrap"]);b.factory("appConfig",[function(){function a(){return"development"}var b={production:{},development:{name:"isentia-angular-challenge",version:"0.0.1",author:"Sandor Agafonoff",license:"MIT License"}};return b[a()]}]),b.run(["$location","$state","$rootScope","$timeout","$window","appConfig",function(a,b,c,d,e,f){c.appConfig=f}])}(window.angular),function(a){"use strict";a.module("webApp").directive("ngRepeatComplete",["$rootScope","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){c.$last&&b(function(){a.$broadcast(e.ngRepeatComplete,!0)})}}}])}(window.angular),function(a){"use strict";a.module("webApp").controller("appController",["$scope",function(a){a.test="hello"}])}(window.angular),function(a){"use strict";a.module("webApp").controller("puzzleController",["$scope","$rootScope",function(a,b){a.moves=0,a.time="",a.playing=!1,a.complete=!1,a["continue"]=!1,a.start=function(){var c=a.complete;b.$broadcast("puzzle.start",c),a.playing=!0,a.complete=!1,a["continue"]||(a.moves=0)},a.$on("puzzle.move",function(b,c){a.$apply(function(){a.moves=c})}),a.$on("puzzle.retrieved",function(b,c){a.moves=c,a["continue"]=!0}),a.$on("puzzle.complete",function(b,c){a.$apply(function(){a.complete=!0,a.playing=!1,a["continue"]=!1,a.time=c})})}])}(window.angular),function(a){"use strict";a.module("webApp").directive("puzzle",["$rootScope","$timeout","puzzleFactory",function(a,b,c){return{restrict:"E",link:function(a,b,d){var e=+d.rows,f=+d.pieces,g=+d.width,h=d.board,i=c.instance(e,f,g,h);b.append(i.getContainer()),a.$on("puzzle.start",function(a,b){b&&i.shuffle(),i.start()})}}}])}(window.angular),function(a,b){"use strict";a.module("webApp").factory("puzzleFactory",["$rootScope","$window","puzzleSaveService","puzzleTimerService",function(c,d,e,f){function g(a,b,d,g){this.rows=a,this.pieces=b,this.width=d,this.board=g,this.size=this.width/this.rows,this.moves=0,this.time=0,this.container=null,this.startingOrder=[],this.shuffledOrder=[],this.getContainer=function(){return this.container},this.save=function(){e.save([].slice.call(this.container[0].children),this.startingOrder,this.moves,f.time()+this.time)},this.retrieve=function(){var a=e.retrieve();this.moves=a.moves,this.time=a.time,this.createPieceOrder(a.positions),this.position()},this.createPieceOrder=function(a){this.shuffledOrder=[];for(var b=0;b<this.startingOrder.length;b++){var c=a[b],d=this.startingOrder[c];this.shuffledOrder.push(d)}},this.notifyMoveCompleted=function(){var a=this.moves;c.$broadcast("puzzle.move",a)}}function h(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}return g.prototype.createContainerElement=function(){return this.container=a.element("<ul/>"),this.container[0].style.width=this.width+"px",this.container[0].style.height=this.width+"px",this.container[0].className="puzzle-board list-unstyled m-0-auto fs-0",this.container},g.prototype.createPieces=function(){for(var a=0,b=0,c=1;c<=this.pieces;c++){var d=b*this.size,e=a*this.size,f=this.createPieceElement(c,d,e);this.startingOrder.push(f[0]),this.shuffledOrder.push(f[0]),c&&c%this.rows===0?(a++,b=0):b++}},g.prototype.createPieceElement=function(b,c,d){var e=a.element("<li />");return e[0].style.width=this.size+"px",e[0].style.height=this.size+"px",e[0].className="order-"+b+" puzzle-piece inline-block area-clickable",e[0].style.backgroundImage="url("+this.board+")",e[0].style.backgroundRepeat="no-repeat",e[0].style.backgroundSize=this.width+"px "+this.width+"px",e[0].style.backgroundPosition="-"+c+"px -"+d+"px",e},g.prototype.generate=function(){return this.createContainerElement(),this.createPieces(),this.container},g.prototype.shuffle=function(){h(this.shuffledOrder);for(var a=0;a<this.shuffledOrder.length;a++)this.container[0].appendChild(this.shuffledOrder[a])},g.prototype.position=function(){for(var a=0;a<this.shuffledOrder.length;a++)this.container[0].appendChild(this.shuffledOrder[a])},g.prototype.start=function(){b(".puzzle-board").sortable({revert:!0,stop:this.move.bind(this)}),b(".puzzle-board").disableSelection(),f.start()},g.prototype.move=function(a,e){if(this.moves++,this.notifyMoveCompleted(),this.save(),this.complete()){f.stop(),this.moves=0,d.localStorage.removeItem("isentia.puzzle"),b(".puzzle-board").sortable("destroy");var g=f.time()+this.time;c.$broadcast("puzzle.complete",g)}},g.prototype.complete=function(){for(var a=0;a<this.startingOrder.length;a++)if(this.container[0].children[a]!==this.startingOrder[a])return!1;return!0},{instance:function(a,b,e,f){var h=new g(a,b,e,f);return h.generate(),d.localStorage["isentia.puzzle"]?(h.retrieve(),c.$broadcast("puzzle.retrieved",h.moves)):h.shuffle(),h}}}])}(window.angular,$),function(a,b){"use strict";a.module("webApp").service("puzzleSaveService",["$window",function(a){return this.save=function(b,c,d,e){var f=[];b.forEach(function(a){var b=c.indexOf(a);f.push(b)});var g={positions:f,moves:d,time:e};a.localStorage["isentia.puzzle"]=JSON.stringify(g)},this.retrieve=function(){return JSON.parse(a.localStorage["isentia.puzzle"])},this}])}(window.angular,$),function(a,b){"use strict";a.module("webApp").service("puzzleTimerService",["$window",function(a){function b(){c={}}var c;this.start=function(){b(),c.start=moment()},this.stop=function(){c.stop=moment()},this.time=function(){var a=c.hasOwnProperty("stop")?c.stop:moment(),b=a.diff(c.start,"seconds");return b}}])}(window.angular,$),function(a){"use strict";a.module("webApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),a.state("app",{"abstract":!0,templateUrl:"./views/components/app/app.html",controller:"appController"}).state("app.puzzle",{url:"/",templateUrl:"./views/components/puzzle/puzzle.html",controller:"puzzleController"}),c.html5Mode(!0)}])}(window.angular);